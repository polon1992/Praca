
\chapter{Kwadratury Newtona-Cotesa dla ca≥ki pojedyÒczej}


Niech $f(x)$ bÍdzie funkcjπ zdefiniowanπ na przedziale $[a,b]$ o wartoúciach rzeczywistych tzn. $f: [a,b]\rightarrow \re$. 
Rozwaømy pewnπ ca≥kÍ \cite{klucz4}
\begin{equation}\label{I(f)=Calkaf(x)}
I(f)=\int\limits_a^b f(x) dx.
\end{equation}

\hspace{-1cm}{FunkcjÍ podca≥kowπ moøemy zastπpiÊ innπ funkcjπ takπ, øe w miarÍ moøliwoúci poniøsze przybliøenie bÍdzie prawdziwe:}
\begin{equation}\label{ZastapienieFunkcjiFxfunkcjaGx}
\int\limits_a^b f(x) dx \approx \int\limits_a^b g(x) dx.
\end{equation}

\hspace{-1cm}{W praktyce czÍsto spotkaÊ moøemy siÍ z przypadkiem takim, ze do wyznaczenia przybliøonych wartoúci $I(f)$  stosowane sπ wzory nazywane kwadraturami. }
Owe kwadratury opierajπ siÍ na wartoúciach $f(x)$ w punktach wÍz≥owych i mogπ niezbyt dok≥adnie przybliøaÊ wynik, tzn: 
\begin{equation}\label{WzorKwadratura}
\int\limits_a^b f(x) dx \approx \sum\limits_{i=0}^n a_if(x_i)=S(f),\,\,\,\, x_i\in[a,b],
\end{equation}
przy czym wspÛ≥czynniki $a_i$ sπ niezaleøne od $f(x)$ (nazywamy je wspÛ≥czynnikami wagowymi kwadratury i okreúlajπ one wielkoúÊ udzia≥u $f(x_i)$ w wartoúci ca≥ej sumy $S(f)$), zaú $x_i$ nosi miano wÍz≥Ûw kwadratury.

Naszym celem jest jednak to, by jak najbardziej zminimalizowaÊ b≥πd pojawiajπcy siÍ podczas przybliøania wartoúci $I(f)$. W zwiπzku z tym moøemy zastosowaÊ zabieg zastπpienia funkcji $f(x)$ w ca≥ce $I(f)$ wielomianem interpolujπcym jπ. W tym celu wykorzystamy \textit{wielomian interpolacyjny Lagrange'a} (\ref{wielomianInterpolacyjnyLagrangea}). Po podstawieniu go do (\ref{WzorKwadratura}) otrzymamy \cite{klucz4}\cite{klucz7}

\vspace{-0.5cm}\begin{equation}\label{SumaCalkowaLagrangeWkwadraturze}
I(f)=\int\limits_a^b f(x) dx \approx \int\limits_a^b L_n(x) dx\approx
\sum\limits_{i=0}^n a_i f(x_i) \approx S(f),
\end{equation}
gdzie 
\begin{equation}\label{wspolczynnikAi}
a_i=\int\limits_a^b l_i(x)dx,
\end{equation}
 natomiast 
 \begin{equation}\label{l_iDlaKwadraturN-C}
 l_i(x)=\prod\limits_{j=0, j\neq i}^n  \frac{x-x_j}{x_i-x_j} \,\,\,\,\,\,\, (i=0,1,\ldots,n).
 \end{equation}
W zwiπzku z powyøszym, ca≥kÍ (\ref{I(f)=Calkaf(x)}) moøemy wyraziÊ w nastÍpujπcy sposÛb:
\begin{equation}\label{PrzyblizenieCalkiSumaCalkowaZwielomianamiBazowymiLagrangea}
\int\limits_a^b f(x) dx \approx \sum\limits_{i=0}^n f(x_i)\int\limits_a^b l_i(x) dx.
\end{equation}
Jeøeli w (\ref{PrzyblizenieCalkiSumaCalkowaZwielomianamiBazowymiLagrangea}) rozpatrzymy tylko wÍz≥y takie, øe $x_0=a$, $x_n=b$, a kaødy wÍze≥ poúredni leøπcy pomiÍdzy $x_0$ a $x_n$ jest postaci $x_i=a+ih$ $(i=0,1,\ldots,n)$, $h=\frac{x_n-x_0}{n}$, to kwadraturÍ takπ nazwiemy \textbf{kwadraturπ Newtona-Cotesa} \cite{klucz2}. Skupimy siÍ na rozwaøeniu dwÛch rÛønych przypadkÛw, dla ktÛrych kolejne wÍz≥y sπ rÛwno odleg≥e - bÍdπ to \textit{wzÛr trapezÛw} oraz \textit{wzÛr Simpsona} .


\section{WzÛr trapezÛw}\label{Podrozdzial_WzorTrapezow}

%Zauwaømy, øe przybliøenie $\sum\limits_{i=0}^n f(x_i)\int\limits_a^b L_i(x) dx$ jest szczegÛlnym przypadkiem sumy z rÛwnania (\ref{WzorKwadratura}), przy czym: 

%\begin{equation}\label{wspolczynnikAi}
%a_i=\int\limits_a^b L_i(x) dx
%\end{equation}


Do wyznaczenia \textit{wzoru trapezÛw} bÍdziemy wykorzystywaÊ \textit{wielomian interpolacyjny Lagrange'a} rzÍdu $n=1$ ($L_1(x)$) utworzony dla wÍz≥Ûw $a$ i $b$.
Zastosujmy w (\ref{l_iDlaKwadraturN-C}) nastÍpujπce podstawienie: $x=a+hs$. Wartoúci $a,h$ sπ pewnymi sta≥ymi \cite{klucz7}, natomiast $s$ jest zmiennπ niezaleønπ:
$$l_i(x)=\prod\limits_{j=0, j\neq i}^n \frac{x-x_j}{x_i-x_j}=
\prod\limits_{j=0, j\neq i}^n \frac{a+hs-(a+jh)}{(a+ih)-(a+jh)}=
\prod\limits_{j=0, j\neq i}^n \frac{s-j}{i-j}$$
Otrzymujemy zatem:
\begin{equation}\label{WielomianLagrangeaPoPodstawieniuZaX}
l_i(x)=\prod\limits_{j=0, j\neq i}^n \frac{s-j}{i-j}=\psi_i(s),
\end{equation}
gdzie $\psi_i(s)$ to nasza nowa funkcja zmiennej $s$.


Ca≥kÍ z rÛwnania (\ref{wspolczynnikAi}) obliczymy metodπ ca≥kowania przez podstawienie. Skorzystamy z przedstawionego przed chwilπ podstawienia $x=a+hs$ oraz rÛwnania (\ref{WielomianLagrangeaPoPodstawieniuZaX}):\\
\begin{equation}\label{WzorNaWspAiWyrazonyCalkaZFunkcjiPsi}
a_i=\int\limits_a^b l_i(x) dx=\left\{\begin{array}{ll}
x=a+hs\\
dx=h ds\\
b=a+hs \Rightarrow \frac{b-a}{h}=s\Rightarrow s=n\\
a=a+hs \Rightarrow 0=hs \Rightarrow s=0
\end{array}\right\}=h\int\limits_0^n \psi_i(s)ds.
\end{equation}

Chcemy wyliczyÊ teraz wartoúci wspÛ≥czynnikÛw kwadratury $a_0$ i $a_1$. PamiÍtamy o tym, øe  do obliczeÒ wykorzystujemy postaÊ \textit{wielomianu Lagrange'a} rzÍdu $n=1$, zatem bÍdziemy ca≥kowali \cite{klucz7} w granicach $[0,n]=[0,1]$:
$$\mathbf{a_0}=h\int\limits_0^1 \psi_0(s) ds=h\int\limits_0^1\frac{s-1}{0-1}ds=\int\limits_0^1(1-s)ds= h\left[s-\frac{s^2}{2}\right]_0^1=\mathbf{\frac{h}{2}},$$
$$\mathbf{a_1}=h\int\limits_0^1 \psi_1(s) ds=h\int\limits_0^1\frac{s-0}{1-0}ds=\int\limits_0^1(s)ds= h\left[\frac{s^2}{2}\right]_0^1=\mathbf{\frac{h}{2}}.$$
Po wstawieniu wyliczonych wspÛ≥czynnikÛw do (\ref{WzorKwadratura}) otrzymujemy 
\begin{equation}\label{wzorTrapezowBrakPodzialu}
\begin{array}{cc}
\int\limits_a^b f(x) dx \approx \sum\limits_{i=0}^1 a_if(x_i)=a_0f(x_0)+a_1f(x_1)=\\
=\frac{h}{2}f(x_0)+\frac{h}{2}f(x_1)=\frac{h}{2}(f(x_0)+f(x_1)).
\end{array}
\end{equation}
WzÛr ten nazywamy \textbf{wzorem trapezÛw}. Zauwaømy, øe suma wspÛ≥czynnikÛw $a_0$,$a_1$ jest rÛwna $h\cdot n$. W kolejnym rozdziale rÛwnieø zetkniemy siÍ z takπ prawid≥owoúciπ rozpatrujπc wyøszy rzπd \textit{wielomianÛw Lagrange'a} dla $n>1$.
%Gdybyúmy wyliczali wspÛ≥czynniki dla $n=2$, to otrzymalibyúmy wzÛr \textit{Simpsona}

Podczas wyznaczania (\ref{wzorTrapezowBrakPodzialu}) przyjÍliúmy, øe przedzia≥ ca≥kowania nie zosta≥ podzielony, a jedynymi wÍz≥ami by≥y jego poczπtek i koniec. W rzeczywistoúci rozpatrujemy przypadki z wielokrotnym podzia≥em przedzia≥u. %Dzieje siÍ tak, poniewaø im wiÍcej podzia≥Ûw dokonamy tym dok≥adniejszy bÍdzie uzyskany wynik. 
Jeøeli przedzia≥ ca≥kowania $[a,b]$ podzielimy na $\geq 2$ rÛwne czÍúci takie, øe $a=x_0<x_1<\ldots<x_n=b$, to otrzymamy \textbf{\textit{uogÛlniony (z≥oøony) wzÛr trapezÛw}}:
\begin{equation}\label{OgolnyWzorTrapezow}
\begin{array}{cc}
\int\limits_a^b f(x)dx=\sum\limits_{i=0}^{n-1}\int\limits_{x_i}^{x_{i+1}}f(x)dx\approx\\ \approx(\frac{h}{2}(f(x_0)+f(x_1))+\cdots+\frac{h}{2}(f(x_{n-1})+f(x_n)))=\\
=\frac{h}{2}(f(x_0)+2f(x_1)+\cdots+2f(x_{n-1})+f(x_n))=\\ 
=\frac{h}{2}\sum\limits_{i=0}^{n-1}[f(x_i)+f(x_{i+1})].
\end{array}
\end{equation}

W wyprowadzonym \textit{wzorze trapezÛw} (\ref{OgolnyWzorTrapezow}) (mÛwiπc wzÛr trapezÛw bÍdziemy mieli na myúli jego postaÊ uogÛlnionπ) przybliøamy wartoúÊ ca≥ki pojedynczej sumujπc pola trapezÛw o ustalonej wysokoúci $h$ (odleg≥oúÊ pomiÍdzy kolejnymi wÍz≥ami) i podstawach o d≥ugoúci $f(x_i)$ i $f(x_{i+1})$ dla $i=0,1,\ldots,n-1$. Rysunek \ref{R2} pomoøe nam zrozumieÊ omawiane zagadnienie.
\begin{figure}[H]
		\begin{center}
		\includegraphics[scale=0.13]{R2.eps} 
		\end{center}
	   \caption{Graficzne przedstawienie idei zastosowania \textit{wzoru trapezÛw} do ca≥kowania}
\hspace{0.52cm}{\footnotesize èrÛd≥o: \url{https://pl.wikipedia.org/wiki/WzÛr\_trapezÛw}}
\label{R2}
\end{figure}
Przejdümy do praktycznego zastosowania  (\ref{OgolnyWzorTrapezow}) w celu pokazania jego przydatnoúci. Obliczenia dla przyk≥adowej pojedynczej ca≥ki oznaczonej przeprowadzimy rÍcznie przyjmujπc relatywnie ma≥π liczbÍ podzia≥Ûw przedzia≥u ca≥kowania, oraz wykorzystujπc procedurÍ stworzonπ w jÍzyku \textit{Maple} dla zdecydowanie wiÍkszych iloúci. 

\begin{ex}{(Wyznaczanie przybliøonej wartoúci ca≥ki przy wykorzystaniu \textit{wzoru trapezÛw})}\label{PrzykladCalkaPojedynczaMetodaTrapezow}\hfill
\textit{Wyznaczymy przybliøonπ wartoúÊ ca≥ki $\int\limits_0^{\frac{3}{2}} e^{x^2} dx$ przyjmujπc, øe przedzia≥ ca≥kowania dzielimy na n=6 rÛwnych czÍúci(7 wÍz≥Ûw).}

Do rozwiπzania zadania skorzystamy z \textit{ogÛlnego wzoru trapezÛw} (\ref{OgolnyWzorTrapezow}). Wyznaczamy wartoúci wÍz≥Ûw oraz odleg≥oúÊ $h=\frac{b-a}{n}$ pomiÍdzy kolejnymi wÍz≥ami:\\
$h=\frac{\frac{3}{2}-0}{6}=\frac{1}{4}$, $x_0=0$, $x_1=\frac{1}{4}$, $x_2=\frac{2}{4}$, $x_3=\frac{3}{4}$, $x_4=1$, $x_5=\frac{5}{4}$, $x_6=\frac{6}{4}$.\\ 
Wyliczone wartoúci wstawiamy do (\ref{OgolnyWzorTrapezow}):
\begin{center}
$\int\limits_0^{\frac{3}{2}} e^{x^2} dx\approx\frac{\frac{1}{4}}{2}(f(x_0)+2f(x_1)+2f(x_2)+2f(x_3)+2f(x_4)+2f(x_5)+f(x_6))=$\\
$=\frac{1}{8}(e^0+2e^{{(\frac{1}{4})}^2}+2e^{{(\frac{2}{4})}^2}+2e^{{(\frac{3}{4})}^2}+2e^1+2e^{{(\frac{5}{4})}^2}+e^{{(\frac{6}{4})}^2})\approx 
\frac{1}{8}(1+2\cdot 1.06449+2\cdot 1.28402+2\cdot 1.75505+2\cdot  2.71828+2\cdot 4.77073+9.48773)\approx 4.20911.$\\
\end{center}
WartoúÊ dok≥adna wynosi w zaokrπgleniu $4.06311405862$. Jak widaÊ rÛønica w wyniku jest dosyÊ znaczπca przy ustalonych wartoúciach wÍz≥Ûw, poniewaø otrzymany przez nas wynik to $4.20911$.
\end{ex}
Z regu≥y im wiÍcej podzia≥Ûw przedzia≥u wykonamy, tym dok≥adniejsze powinniúmy otrzymamy przybliøenie. Moøna rÛwnieø wnioskowaÊ w ten sposÛb  poddajπc siÍ analizie wzoru na \textit{b≥πd metody trapezÛw} (im wiÍkszy $n$ tym mniejsza wartoúÊ $\delta_T$):
\begin{definition}{(B≥πd przybliøenia uogÛlnionym wzorem trapezÛw)}\\\hfill
Przyjmijmy, øe $BBT_n$ oznacza b≥πd bezwzglÍdny przybliøenia(rÛønica pomiÍdzy wartoúciπ dok≥adnπ i przybliøonπ ca≥ki). Ponadto niech $f: [a,b]\rightarrow \re$ bÍdzie klasy $C^2$ na $[a,b]$, oraz $n$ wyznacza iloúÊ podzia≥Ûw tego przedzia≥u, wtedy spe≥niona jest nastÍpujπca nierÛwnoúÊ \cite{klucz6}
\begin{equation}\label{NierownoscBBPrzyblizenia<=DeltaT}
|BBT_n|\leq\delta_T.
\end{equation}
Symbol $\delta_T$ oznacza \textit{b≥πd metody trapezÛw} i wyraøa go nastÍpujπcy wzÛr: 
\begin{equation}\label{BladMetodyTrapezow}
\delta_T = \frac{(b-a)^3}{12n^2} \cdot M_2,
\end{equation}
gdzie 
\begin{equation}\label{CzynnikM2DoBleduMetodyTrapezow}
M_2= \sup\limits_{x \in [a,b]} \, | f^{''}(x) |.
\end{equation}


\end{definition}
Sprawdzimy jednak s≥usznoúÊ naszego twierdzenia wykorzystujπc do tego stworzonπ na nasze potrzeby procedurÍ w jÍzyku \textit{Maple}. Pos≥uøy nam ona do zautomatyzowania procesu obliczania przybliøonych wartoúci ca≥ek oznaczonych omawianπ metodπ:

\begin{proc}{(Wznaczanie przybliøonych wartoúci ca≥ek pojedynczych \textit{metodπ trapezÛw})}\label{MAPLE_MetodaTrapezowCalkaPojedyncza}
\begin{verbatim}
> trapez:=proc(a,b,n) 
local h,j,i,x,y,t,tp;
 if (((ceil(n)>n) or (floor(n)<n)) or n<=0)
 then ERROR('Ostatni parametr musi byc liczba naturalna')else 
   h:=(b-a)/n; 
   for j from 0 to n do x:= j -> a+j*h od;  
   for j from 0 to n do y:= j -> f(x(j)) od;  
   t:= h/2 * sum(y(i)+y(i+1), i=0..n-1); 
   tp:=evalf(t,12);
 fi; 
end;
\end{verbatim}
\end{proc}

\hspace{-1cm}{Przed przejúciem do prezentacji wynikÛw jakie zwrÛci powyøsza procedura, naleøy wyjaúniÊ nieco jej zasadÍ dzia≥ania i znaczenie parametrÛw.}

\hspace{-1cm}{Pierwsza linia jest deklaracjπ procedury \textit{trapez} z nastÍpujπcymi parametrami wejúciowymi:}\\
\textbf{a}, \textbf{b} - sπ odpowiednio dolnym i gÛrnym kraÒcem przedzia≥u ca≥kowania\\
\textbf{n} - okreúla liczbÍ podprzedzia≥Ûw na ktÛre podzielony zostanie nasz przedzia≥ $[a,b]$\\
Kolejno deklarujemy zmienne pomocnicze z ktÛrych korzysta procedura ( nie pobierane od uøytkownika). Jeøeli ostatni parametr $n \nin \mathbb{N}$ to zwracany jest stosowny komunikat i procedura koÒczy swoje dzia≥anie, w p.p. wykonuje siÍ g≥Ûwny algorytm tzn. obliczamy wartoúÊ kroku $h$, czyli odleg≥oúÊ pomiÍdzy dwoma kolejnymi wÍz≥ami. NastÍpnie wyznaczamy wszystkie wÍz≥y $x_i$ na danym przedziale oraz wyliczamy wartoúci (deklarowanej przed wywo≥ywaniem procedury) funkcji $f$ w tychøe wÍz≥ach. Przedostatni krok polega na zsumowaniu wyliczonych przed chwilπ wartoúci w sposÛb zgodny ze wzorem (\ref{OgolnyWzorTrapezow}). Algorytm koÒczymy poprzez przekszta≥cenie sumy do "przyjaznej" \,postaci i prezentacjÍ wyniku w formacie 12 znakowym. 


Poniøsza tabela prezentuje wyniki \textbf{Procedury  \ref{MAPLE_MetodaTrapezowCalkaPojedyncza}} (ozn. $W_{trapez}$) dla coraz to wiÍkszej liczby podprzedzia≥Ûw (ozn. $n$). UwzglÍdniono w niej rÛwnieø wartoúci b≥ÍdÛw wzoru trapezÛw (ozn. $\delta_T$) wyliczone zgodnie ze wzorem (\ref{BladMetodyTrapezow}) oraz modu≥  rÛønicy pomiÍdzy wartoúciπ dok≥adnπ ca≥ki a otrzymanπ w ramach testÛw procedury (ozn. $|BBT_n|$, zgodnie z (\ref{NierownoscBBPrzyblizenia<=DeltaT})). Do kalkulacji wykorzystamy funkcjÍ z \textit{Przyk≥adu \ref{PrzykladCalkaPojedynczaMetodaTrapezow}} oraz podanπ w rozwiπzaniu informacjÍ na temat przybliøonej do 11 miejsca po przecinku wartoúci dok≥adnej ca≥ki $\int\limits_0^{\frac{3}{2}} e^{x^2} dx\approx 4.06311405862$. \\ 

\vspace{-0.4cm}
\begin{table}[h!]
\caption{Wyniki pomiaru dok≥adnoúci przybliøenia wartoúci ca≥ki procedurπ \textit{trapez}}
\hspace{-4.8cm}{\footnotesize èrÛd≥o: Opracowanie w≥asne\\}
\centering
 \begin{tabular}{|c|c|c|c|} 
 \hline
 $\mathbf{n}$ & $\mathbf{W_{trapez}}$ & $\mathbf{|BBT_n|}$ &$\mathbf{\delta_T}$ \\ [0.5ex] 
 \hline \hline
 6 & 4.20911436529  & 0.146000306 &  0.815352298  \\ 
 \hline
 30& 4.06904019209  & 0.005926133  & 0.032614091 \\
 \hline 
 100& 4.06364771371  &0.000533655 & 0.002935268  \\
 \hline 
 200& 4.06324747807 & 0.000133419 &  0.000733817  \\
 \hline 
 400& 4.06314741384 & 0.000033355 &  0.000183454 \\ 
  \hline 
 800& 4.06312239755  &0.000008339 & 0.000045863 \\
  \hline 
 2000& 4.06311539304  & 0.000001334 &0.000007338 \\
  \hline 
 5000& 4.06311427243 & 0.000000213  &0.000001174 \\
  \hline 
 7310& 4.06311415812 &  0.000000099 &0.000000549 \\
  \hline 
 10000& 4.06311411177 & 0.000000053 &0.000000293 \\
  \hline 
 30000& 4.06311406426 & 0.000000005 &0.000000032 \\
  \hline 
 50000& 4.06311406037 & 0.000000002 &0.000000011 \\
  \hline 
 70000& 4.06311406006 & 0.000000001 &0.000000005 \\[0.5ex] 
 \hline 
 \end{tabular}\\\hfill
 \label{WynikiZProceduryTrapez1}

\end{table}
\newpage
Na podstawie powyøszych pomiarÛw moøemy uznaÊ iø nasze przewidywania odnoúnie tego, øe w miarÍ wzrostu wartoúci $n$ wynik bÍdzie coraz dok≥adniejszy okazujπ siÍ byÊ trafne. Procedura generuje prawid≥owe wyniki, co moøna potwierdziÊ tym, ze dla $n=6$ wartoúÊ obliczona "{rÍcznie}"\, jest taka sama jak otrzymana w trakcie badaÒ. Zauwaømy, øe juø przy $n\geq 100$ wynik zaczyna byÊ dosyÊ mocno zbliøony do dok≥adnego - rÛønice pojawiajπ siÍ dopiero na 4 miejscu po przecinku.
UwagÍ naleøy skupiÊ rÛwnieø na wartoúciach $\mathbf{|BBT_n|}$ i $\mathbf{\delta_T}$ z Tablicy \ref{WynikiZProceduryTrapez1}. Po ich dok≥adnej analizie jesteúmy w stanie zauwaøyÊ, øe $\mathbf{|BBT_n|}$ jest zawsze wiÍksze od $\mathbf{\delta_T}$. Nie ma znaczenia to, jaki $n$ przyjÍliúmy. Nie jest to jednak przypadkowa zaleønoúÊ. Fakt ten w pe≥ni wyjaúnia nam definicja \ref{BladMetodyTrapezow}. WartoúÊ $\delta_T$ zosta≥a wyznaczona przy wykorzystaniu nastÍpujπcego skryptu:

\begin{proc}{(Wyznaczanie b≥Ídu przybliøenia dla \textit{metody trapezÛw})}
\label{MAPLE_BladMetodyTrapezowCalkaPojedyncza}
\begin{verbatim}
> trapezBlad:= proc (a, b, n)
 local d2ff, simd2ff, M2, deltaT;
 if (((ceil(n)>n) or (floor(n)<n)) or n<=0)
  then ERROR('Ostatni parametr musi byc liczba naturalna')
 else 
  d2ff:= diff(diff(f(x), x), x); 
  simd2ff:= simplify(d2ff); 
  M2:= (Optimization[Maximize])(abs(simd2ff), x = a .. b); 
  deltaT:= evalf(1/12*M2[1]*(b-a)^3/n^2)
 fi; 
end;
\end{verbatim}
\end{proc}    
Procedura ta opiera siÍ na wzorach (\ref{BladMetodyTrapezow}) oraz (\ref{CzynnikM2DoBleduMetodyTrapezow}). Wynikiem jej dzia≥ania jest wartoúÊ b≥Ídu $\delta_T$ dla ca≥ki z $f$ (funkcja musi zostaÊ zdefiniowana przed wywo≥aniem \textit{trapezBlad}) liczonej w granicach $[a,b]$ przy dokonanych $n$ podzia≥ach tego przedzia≥u. Parametry wejúciowe sπ definiowane tak samo jak dla \textbf{Procedury \ref{MAPLE_MetodaTrapezowCalkaPojedyncza}}. Dok≥adny opis algorytmu dla tego przypadku zostaje pominiÍty. 

CzÍsto przeprowadzajπc obliczenia naukowe musimy zadbaÊ o to, by wynik jaki otrzymamy by≥ jak najdok≥adniejszy i obciπøony co najwyøej pewnym b≥Ídem, nie wiÍkszym niø dopuszczalny. RÛwnieø wykorzystujπc \textit{wzÛr trapezÛw} do ca≥kowania numerycznego, moøemy kontrolowaÊ wielkoúÊ b≥Ídu, jaki pojawia siÍ podczas przybliøania wyniku. Sposobem na to jest odpowiedni dobÛr liczby podzia≥Ûw przedzia≥u ca≥kowania. Poniøsza procedura wskazuje nam, ile co najmniej owych podzia≥Ûw powinniúmy dokonaÊ, by wielkoúÊ b≥Ídu nie przekracza≥a zdefiniowanej przez nas wartoúci.\\  
 
\begin{proc}{(Wyznaczanie najmniejszej liczby $n$ podzia≥Ûw przedzia≥u ca≥kowania tak, by wynik by≥ obciπøony b≥Ídem nie wiÍkszym niø zadany)}
\label{MAPLE_najmniejszyNDlaMetodyTrapezowCalkaPojedyncza}
\begin{verbatim}
> trapeznMin:= proc (a, b, blad) 
  local d2ff, simd2ff, M2, nMin, p;
  d2ff:= diff(diff(f(x), x), x);
  simd2ff:= simplify(d2ff); 
  M2:= (Optimization[Maximize])(abs(simd2ff), x = a .. b);
  p:= solve*({1/12*(b-a)^3*M2[1]/n^2 < blad, 0 < n}, {n}); 
  nMin := p[1] 
end;
\end{verbatim}
\end{proc}

Powyøsza procedura rÛwnieø korzysta ze wzorÛw (\ref{BladMetodyTrapezow}) i (\ref{CzynnikM2DoBleduMetodyTrapezow}). Jej parametry wejúciowe $a$ i $b$ sπ tak jak poprzednio granicami ca≥kowania pewnej funkcji $f$, natomiast $blad$ okreúla jaki b≥πd przybliøenia jest przez nas maksymalnie akceptowalny. Kod znajdujπcy siÍ wewnπtrz procedury kolejno oblicza $f^{''}(x)$ i upraszcza postaÊ wyliczonej pochodnej. NastÍpnie szukana jest wartoúÊ $M_2= \sup\limits_{x \in [a,b]} \, | f^{''}(x) |$. Najwaøniejszym elementem sk≥adowym \textit{trapeznMin} jest jednak wyliczanie wartoúci dla zmiennej $p$. By jπ wyznaczyÊ rozwiπzujemy nierÛwnoúÊ \mbox{$\frac{(b-a)^3}{12n^2} \cdot M_2<blad$} ze wzglÍdu na $n$. Zak≥adamy, øe interesujπ nas tylko $n>0$ ($n$ jest liczbπ podzia≥Ûw i musi byÊ wartoúciπ ca≥kowitπ dodatniπ). Ostatnia linia odpowiada za prezentacjÍ obliczonej wartoúci $n$. Wynik pojawia siÍ w postaci $N>z$, gdzie $z$ jest liczbπ ca≥kowitπ - zatem za rezultat uwaøaÊ bÍdziemy najmniejszπ liczbÍ naturalnπ wiÍkszπ od $z$.



\section{WzÛr Simpsona}
%wyciete 2 zdanie - Charakteryzuje siÍ ona duøπ dok≥adnoúciπ przy jednoczeúnie niewielkiej z≥oøonoúci rachunkÛw.
CzÍsto wykorzystywanπ przy ca≥kowaniu numerycznym metodπ jest \textit{metoda Simpsona}. Zamiennie nazywana jest rÛwnieø \textit{metodπ parabol}. Jej nazwa wywodzi siÍ od tego, øe funkcjÍ podca≥kowπ przybliøamy na kaødym z podprzedzia≥Ûw utworzonych przez \textbf{3} wÍz≥y za pomocπ paraboli. W zwiπzku z tym, øe kaøde $3$ kolejne wÍz≥y tworzπ \textbf{2} podprzedzia≥y wnioskujemy, øe ca≥kowita liczba podprzedzia≥Ûw przedzia≥u ca≥kowania jest postaci $N=2m$ dla $m\in\mathbb{N}$ (we \textit{wzorze trapezÛw} nie by≥o wymagane, by liczba podprzedzia≥Ûw by≥a parzysta). 

Przybliøonym wynikiem oznaczonej ca≥ki pojedynczej, obliczanej \textit{metodπ Simpsona} jest suma pÛl tzw. trapezÛw "parabolicznych"\,  (jedno z ramion trapezu jest parabolπ). Kaødy z nich jest ograniczany przez wÍz≥y $x_{2i}$ i $x_{2i+2}$ ($i=0,1,\ldots, m-1$) na osi $OX$, natomiast na osi $OY$ ogranicza je prosta $y=0$ oraz parabola przechodzπca przez $x_{2i}$, $x_{2i+1}$, $x_{2i+2}$ ($i=0,1,\ldots, m-1$). Naleøy zauwaøyÊ, øe istnieje dok≥adnie jedna parabola zawierajπca zadane trzy wÍz≥y, wiÍc jej rÛwnanie zawsze bÍdzie wyznaczone w sposÛb jednoznaczny. Metoda ca≥kowania przy wykorzystaniu wzoru \textit{Simpsona} zosta≥a przedstawiona na Rysunku \ref{R3}.

\begin{figure}[H]
		\begin{center}
	\includegraphics[scale=0.45]{R3.eps} 
		\end{center}
	   \caption{Graficzne przedstawienie idei zastosowania \textit{wzoru parabol} do ca≥kowania}
\label{R3}
\hspace{0.7cm}{\footnotesize èrÛd≥o: \url{https://commons.wikimedia.org/wiki/File:Composite\_Simpsons\_rule.png}}
\end{figure}
  
Rozpatrzmy poczπtkowo szczegÛlny przypadek, w ktÛrym przedzia≥ ca≥kowania zostanie podzielony na dok≥adnie $2$ podprzedzia≥y, wydzielone przez $3$ rÛwno odleg≥e wÍz≥y \mbox{$a=x_0 < x_1 < x_2=b$}, dla ktÛrych zachodzi $\frac{x_0+x_2}{2}=x_1$. W celu wyprowadzenia wzoru \textit{Simpsona} wykorzystamy \textit{wielomian interpolacyjny Lagrange'a} $L_2(x)$ (wielomian rzÍdu $n=2$) zbudowany zgodnie z (\ref{wielomianInterpolacyjnyLagrangea}) dla wÍz≥Ûw $a=x_0$, $x_1$, $x_2=b$. By stworzyÊ $L_2(x)$, ktÛry nas interesuje, potrzebna nam jest wiedza na temat tego, jak wyglπdajπ wspÛ≥czynniki \mbox{$a_0$, $a_1$, $a_2$}. Ich wartoúÊ wyliczymy wykorzystujπc wzory  (\ref{WielomianLagrangeaPoPodstawieniuZaX}) oraz (\ref{WzorNaWspAiWyrazonyCalkaZFunkcjiPsi}). Wynika z nich, øe kaødy ze wspÛ≥czynnikÛw $a_i$ ($i=0,1,\ldots,n$) jest postaci:
\begin{equation}\label{WspolczynnikAiWPostaciCalkiZIloczynu}\\
a_i=h\int\limits_0^n \psi_i(s) ds=h\int\limits_0^n \left(\prod\limits_{j=0, j\neq i}^n \frac{s-j}{i-j}\right)ds.
\end{equation}  

W tym przypadku za $n$ przyjmujemy rzπd wielomianu interpolacyjnego $L_2(x)$, zatem ca≥kowanie odbÍdzie siÍ w granicach $[0,n]=[0,2]$: 
$$\mathbf{a_0}=h\int\limits_0^2 \psi_0(s)ds=h\int\limits_0^2\left(\prod\limits_{j=0, j\neq i}^2 \frac{s-j}{i-j}\right)ds=h\int\limits_0^2\left(\frac{(s-1)}{(0-1)}\cdot\frac{(s-2)}{(0-2)}\right)ds=h\int\limits_0^2\frac{(s^2-2s-s+2)}{2}ds=$$$$=\frac{h}{2}\int\limits_0^2\left(s^2-3s+2\right)ds=\frac{h}{2}\left[\frac{s^3}{3}-\frac{3s^2}{2}+2s\right]_0^2=\frac{h}{2}\left(\left[\frac{8}{3}-\frac{12}{2}+4\right]-0\right)=\frac{h}{2}\cdot\frac{2}{3}=\mathbf{\frac{h}{3}},$$
$$\mathbf{a_1}=h\int\limits_0^2 \psi_1(s)ds=h\int\limits_0^2\left(\prod\limits_{j=0, j\neq i}^2 \frac{s-j}{i-j}\right)ds=h\int\limits_0^2\left(\frac{(s-0)}{(1-0)}\cdot\frac{(s-2)}{(1-2)}\right)ds=h\int\limits_0^2\frac{(s^2-2s)}{-1}ds=$$$$=h\int\limits_0^2\left(2s-s^2\right)ds=h\left[2\frac{s^2}{2}-\frac{s^3}{3}\right]_0^2=h\left(\left[4-\frac{8}{3}\right]-0\right)=h\cdot\frac{4}{3}=\mathbf{\frac{4h}{3}},$$
$$\mathbf{a_2}=h\int\limits_0^2 \psi_2(s)ds=h\int\limits_0^2\left(\prod\limits_{j=0, j\neq i}^2 \frac{s-j}{i-j}\right)ds=h\int\limits_0^2\left(\frac{(s-0)}{(2-0)}\cdot\frac{(s-1)}{(2-1)}\right)ds=h\int\limits_0^2\frac{s(s-1)}{2}ds=$$$$=\frac{h}{2}\int\limits_0^2\left(s^2-s\right)ds=\frac{h}{2}\left[\frac{s^3}{3}-\frac{s^2}{2}\right]_0^2=\frac{h}{2}\left(\left[\frac{8}{3}-\frac{4}{2}\right]-0\right)=\frac{h}{2}\cdot\frac{2}{3}=\mathbf{\frac{h}{3}}.$$
Podstawiajπc obliczone powyøej wartoúci $a_0, a_1, a_2$ do (\ref{WzorKwadratura}) otrzymujemy szukany przez nas \textbf{wzÛr \textit{Simpsona}}: 
\begin{equation}\label{wzorSimpsonaBrakPodzialu}
\begin{array}{cc}
\int\limits_a^b f(x) dx \approx \sum\limits_{i=0}^2 a_if(x_i)=a_0f(x_0)+a_1f(x_1)+a_2f(x_2)=\\
=\frac{h}{3}f(x_0)+\frac{4h}{3}f(x_1)+\frac{h}{3}f(x_2)=\frac{h}{3}(f(x_0)+4f(x_1)+f(x_2)).
\end{array}
\end{equation}
Zauwaømy, øe dla tego przypadku zachodzi rÛwnieø prawid≥owoúÊ zwiπzana z wartoúciπ sumy wspÛ≥czynnikÛw, adekwatna do tej ze wzoru trapezÛw: $a_0+a_1+a_2=\frac{h}{3}+\frac{4h}{3}+\frac{h}{3}=n\cdot h=2\cdot h$. Moøemy zatem wnioskowaÊ, øe powyøsze obliczenia zosta≥y przeprowadzone prawid≥owo.

RÛwnanie (\ref{wzorSimpsonaBrakPodzialu}) opisuje przypadek, w ktÛrym ca≥ka $\int\limits_a^b f(x)dx$ jest przybliøana polem znajdujπcym siÍ tylko pod jednπ parabolπ na przedziale $[a,b]$ (podzielono go na dwa rÛwne podprzedzia≥y $[a=x_0,x_1]$ i $[x_1,x_2=b]$). Wykres omawianej paraboli przechodzi przez punkty $(a=x_0,f(x_0))$, $(\frac{b+a}{2}=x_1,f(x_1))$, $(b=x_2,f(x_2))$. 

Dla przypadku ogÛlnego, w ktÛrym przedzia≥ ca≥kowania $[a,b]$ zostanie podzielony na $N=2m$ \mbox{($m=1,2,\ldots$)} podprzedzia≥Ûw rÛwnej d≥ugoúci $h=\frac{b-a}{N}=\frac{b-a}{2m}$, przy czym kaødy wÍze≥ jest postaci $x_i=a+ih$ \mbox{($i=0,1,2,\ldots, N=2m$)}, wzÛr (\ref{wzorSimpsonaBrakPodzialu}) przyjmuje nastÍpujπcπ formÍ:
\begin{equation}\label{wzorSimpsonaZPodzialami}
\begin{array}{cc}
\int\limits_a^b f(x)dx = \sum\limits_{i=0}^{m-1} \int\limits_{x_{2i}}^{x_{2i+2}} f(x) dx \approx\\
\approx\left(\frac{h}{3}\left(f(x_0)+4f(x_1)+f(x_2)\right)+\ldots+ \frac{h}{3}\left(f(x_{2m-2})+4f(x_{2m-1})+f(x_{2m})\right)\right)=\\
=\frac{h}{3}\left(f(x_0)+4(f(x_1)+f(x_3)+\ldots+f(x_{2m-1}))+2(f(x_2)+f(x_4)+\ldots+f(x_{2m-2}))+f(x_{2m})\right)=\\
=\frac{h}{3}\sum\limits_{i=0}^{m-1}\left(f(x_{2i})+4f(x_{2i+1})+f(x_{2i+2})\right).
\end{array}
\end{equation}
RÛwnanie (\ref{wzorSimpsonaZPodzialami}) nosi miano \textbf{uogÛlnionego wzoru Simpsona} (mÛwiπc wzÛr \textit{Simpsona} bÍdziemy mieli na myúli tÍ postaÊ uogÛlnionπ). W zwiπzku z tym, iø wzÛr ten jedynie przybliøa dok≥adnπ wartoúÊ ca≥ki, to wiπøe siÍ z tym fakt obciπøenia wyniku pewnym b≥Ídem. Oszacowanie owego b≥Ídu przybliøenia \textit{wzorem Simpsona} wyjaúnia poniøsza definicja:
\begin{definition}(B≥πd przybliøenia \textit{wzorem Simpsona})\\
\label{Def_BladPrzyblizeniaWzoremSimpsona}
Przyjmijmy, øe $BBS_{N}$ oznacza b≥πd bezwzglÍdny przybliøenia (tzn. rÛønica pomiÍdzy wartoúciπ dok≥adnπ i przybliøonπ ca≥ki). Ponadto niech $f: [a,b]\rightarrow \re$ bÍdzie klasy $C^4$ na $[a,b]$, oraz $N=2m$ ($m\in\mathbb{N}$) wyznacza iloúÊ podzia≥Ûw przedzia≥u $[a,b]$, wtedy spe≥niona jest nastÍpujπca nierÛwnoúÊ \cite{klucz6}:
\begin{equation}\label{NierownoscBBPrzyblizenia<=DeltaS}
|BBS_{N}|\leq\delta_S.
\end{equation}
Przez $\delta_S$ rozumiemy \textit{b≥πd metody Simpsona}, ktÛry jest opisany nastÍpujπcym wzorem:
\begin{equation}\label{BladMetodySimpsona}
\delta_S = \frac{(b-a)^5}{180 \cdot N^4} \cdot M_4\stackrel{N=2m}{=}\frac{(b-a)^5}{2880 \cdot m^4} \cdot M_4 ,
\end{equation}
przy czym 
\begin{equation}\label{CzynnikM4DoBleduMetodySimpsona}
M_4= \sup\limits_{x \in [a,b]} \, | f^{(4)}(x) |.
\end{equation}
\end{definition} 

Zbadajmy dok≥adnoúÊ, z jakπ wzÛr (\ref{wzorSimpsonaZPodzialami}) przybliøa wartoúci ca≥ek oznaczonych. W tym celu przedstawmy kompletne wyliczenia dla przypadku, gdzie liczba podzia≥Ûw przedzia≥u ca≥kowania bÍdzie wzglÍdnie ma≥a, natomiast sama ca≥ka okreúlona tak jak w \textbf{Przyk≥adzie \ref{PrzykladCalkaPojedynczaMetodaTrapezow}}. 

\begin{ex}(Wyznaczanie przybliøonej wartoúci ca≥ki \textit{metodπ Simpsona})\\\hfill\label{PrzykladCalkaLiczonaWzoremSimpsona}
\textit{Obliczymy przybliøonπ wartoúÊ ca≥ki $\int\limits_0^{\frac{3}{2}} e^{x^2} dx$ dzielπc przedzia≥ ca≥kowania na $N=2m=6$ podprzedzia≥Ûw rÛwnej d≥ugoúci ($7$ wÍz≥Ûw).}\\\newline
Do wykonania rachunkÛw niezbÍdna jest nam d≥ugoúÊ podprzedzia≥u $h=\frac{b-a}{N}$ \mbox{($[a,b]=[0,\frac{3}{2}]$)} oraz wartoúci wÍz≥Ûw $x_i=a+ih$ ($i=0,1,\ldots,6$). \\
Zatem: $h=\frac{\frac{3}{2}-0}{6}=\frac{1}{4}$, $x_0=0$, $x_1=\frac{1}{4}$, $x_2=\frac{2}{4}$, $x_3=\frac{3}{4}$, $x_4=1$, $x_5=\frac{5}{4}$, $x_6=\frac{6}{4}$.\\
Kolejno wstawiamy powyøsze dane do \textit{uogÛlnionego wzoru Simpsona }(\ref{wzorSimpsonaZPodzialami}):
\begin{gather*}
\int\limits_0^{\frac{3}{2}} e^{x^2} dx \approx \frac{\frac{1}{4}}{3}\sum\limits_{i=0}^{2}\left(f(x_{2i})+4f(x_{2i+1})+f(x_{2i+2})\right) = \\
=\frac{1}{12}\left((f(x_0)+4f(x_1)+f(x_2))+(f(x_2)+4f(x_3)+f(x_4))+(f(x_4)+4f(x_5)+f(x_6)) \right)=\\
=\frac{1}{12}\left(\left(e^{0^2}+4e^{{\left(\frac{1}{4}\right)}^2}+e^{{\left(\frac{2}{4}\right)}^2}\right)+\left(e^{{\left(\frac{2}{4}\right)}^2}+4e^{{\left(\frac{3}{4}\right)}^2}+e^{{1}^2}\right)+\left(e^{1^2}+4e^{{\left(\frac{5}{4}\right)}^2}+e^{{\left(\frac{6}{4}\right)}^2}\right)\right)=\\
=\frac{1}{12}\left(e^0+4\left(e^{\left(\frac{1}{16}\right)}+e^{\left(\frac{9}{16}\right)}+e^{\left(\frac{25}{16}\right)}\right)+2\left(e^{\left(\frac{4}{16}\right)}+e\right)+e^{\left(\frac{36}{16}\right)}\right)=\\
=\frac{1}{12}(1+4(1.06449+1.75505+4.77073)+2(1.28402+2.71828)+9.48773)=4.071123.
\end{gather*}
\end{ex}
Wynik, ktÛry otrzymaliúmy w przeprowadzonych obliczeniach jest bardzo zbliøony do wartoúci dok≥adnej $\int\limits_0^{\frac{3}{2}} e^{x^2} dx=4.06311405862...$. Chcemy jednak sprawdziÊ, przy jak duøej liczbie podzia≥Ûw przedzia≥u ca≥kowania przybliøenie zacznie siÍ stabilizowaÊ tak, byúmy mogli uznaÊ je za wystarczajπco rzetelne (przyjmijmy, øe b≥πd bezwzglÍdny przybliøenia ma byÊ nie wiÍkszy niø $0.0000001$). Podobnie jak dla wzoru trapezÛw, wykorzystajmy stworzone na nasze potrzeby procedury automatyzujπce przeprowadzanie obliczeÒ. \\ 

\begin{proc}{(Wznaczanie przybliøonych wartoúci ca≥ek pojedynczych \textit{metodπ Simpsona})}\label{MAPLE_MetodaSimpsonaCalkaPojedyncza}
\begin{verbatim}
>simpson :=proc(a,b,N) 
local h,i,j,m,x,y,s,sp;
 if (((ceil(N)>N) or (floor(N)<N)) or (mod(N,2)=1 and N>0) or N<=0)
 then ERROR('Ostatni parametr musi byc liczba naturalna postaci \2m')
 else
    m:=N/2; 
    h:=(b-a)/(2*m); 
    for j from 0 to 2*m do x:= j -> a+j*h od;  
    for j from 0 to 2*m do y:= j -> f(x(j)) od;  
    s:= h/3 * sum(y(2*i)+4*y(2*i+1)+y(2*i+2), i=0..m-1); 
    sp:=evalf(s,12);
 fi; 
end;
\end{verbatim}
\end{proc}      

Powyøszy skrypt tworzy procedurÍ w jÍzyku \textit{Maple}, realizujπcπ algorytm wyznaczania przybliøonej wartoúÊ ca≥ki pojedynczej metodπ \textit{Simpsona}. Jej parametrami wejúciowymi sπ:\\
$\mathbf{a}$ - wartoúÊ dolnej granicy ca≥kowania\\
$\mathbf{b}$ - wartoúÊ gÛrnej granicy ca≥kowania\\
$\mathbf{N}$ - opisuje iloúÊ podzia≥Ûw przedzia≥u ca≥kowania funkcji $f(x)$ (konieczne jest zdefiniowanie $f(x)$ przed wywo≥aniem kaødej prezentowanej w tym podrozdziale procedury). WartoúÊ parametru $N$ musi byÊ liczbπ naturalnπ i podzielnπ przez $2$, gdyø zastosowanie metody parabol  wymaga co najmniej $2$ podprzedzia≥Ûw wydzielonych przez $3$ rÛwno odleg≥e wÍz≥y.\\
Kod znajdujπcy siÍ po nag≥Ûwku procedury to definicja zmiennych lokalnych, wykorzystywanych wewnπtrz owej procedury. Kolejno sprawdzana jest poprawnoúÊ wprowadzonego parametru $N$. Jeøeli $N$ posiada niezerowπ czÍúÊ dziesiÍtnπ, bπdü jest liczbπ naturalnπ nieparzystπ lub  ca≥kowitπ \mbox{$\leq 0$}, wtedy algorytm koÒczy swoje dzia≥anie zwracajπc b≥πd o treúci 'Ostatni parametr musi by liczba naturalna postaci 2m'. W przeciwnym wypadku nastÍpuje przejúcie do g≥Ûwnego algorytmu, ktÛry rozpoczyna siÍ od obliczenia iloúci par podprzedzia≥Ûw oraz odleg≥oúci $h$ pomiÍdzy kolejnymi punktami wÍz≥owymi. NastÍpnie wyznaczane sπ wszystkie wÍz≥y $x_i$ na danym przedziale $[a,b]$ oraz obliczane wartoúci funkcji $f(x)$ w tych wÍz≥ach. Przedostatni krok polega na zsumowaniu wyliczonych przed chwilπ wartoúci $f(x_i)$ w sposÛb zgodny ze wzorem (\ref{wzorSimpsonaZPodzialami}). Ostatecznie procedura upraszcza postaÊ sumy i zwraca jπ w formie 12 znakowego wyniku (nie wliczajπc w to przecinka).

Zanim zaprezentujemy wyniki zwracane przez \textbf{ProcedurÍ \ref{MAPLE_MetodaSimpsonaCalkaPojedyncza}}, to zechciejmy pochyliÊ siÍ jeszcze przez moment nad kodem dodatkowej procedury umoøliwiajπcej oszacowanie b≥Ídu $\delta_S$ z rÛwnania (\ref{BladMetodySimpsona}). Informacja na temat jego wielkoúci bÍdzie nam pomocna podczas kontroli, czy obliczenia sπ przeprowadzane poprawnie, tzn. musi zachodziÊ $|BBS_{N}|\leq\delta_S$ (\ref{NierownoscBBPrzyblizenia<=DeltaS}) dla coraz to wiÍkszych iloúci podzia≥Ûw przedzia≥u ca≥kowania.

\begin{proc}{(Wyznaczanie b≥Ídu przybliøenia dla \textit{metody Simpsona})}
\label{MAPLE_BladMetodySimpsonaCalkaPojedyncza}
\begin{verbatim}
> simpsonBlad:= proc(a, b, N)
local d4ff, simd4ff, M4, deltaS;
 if (((ceil(N)>N) or (floor(N)<N)) or (mod(N,2)=1 and N>0) or N<=0)
 then ERROR('Ostatni parametr musi byc liczba naturalna postaci \2m')
 else
  d4ff:= diff(diff(diff(diff(f(x),x),x),x),x); 
  simd4ff:= simplify(d4ff); 
  M4:= (Optimization[Maximize])(abs(simd4ff), x = a .. b); 
  deltaS:= evalf(1/180*M4[1]*(b-a)^5/N^4);
 fi; 
end;
\end{verbatim}
\end{proc}
Powyøsza procedura ma za zadanie wyznaczyÊ wartoúÊ $\delta_S$, tak by prawdziwe by≥o oszacowanie (\ref{NierownoscBBPrzyblizenia<=DeltaS}). Parametry $a$, $b$ i $N$ definiowane sπ w sposÛb identyczny, jak w \mbox{\textbf{Procedurze \ref{MAPLE_MetodaSimpsonaCalkaPojedyncza}}}. Aby wykona≥ siÍ algorytm g≥Ûwny (znajdujπcy siÍ wewnπtrz procedury w bloku \textit{else}), ponownie musi zostaÊ spe≥niony warunek mÛwiπcy o tym, øe $N$ jest liczπ naturalnπ i parzystπ. Jeøeli taka prawid≥owoúÊ zachodzi, to obliczamy wartoúÊ $f^{(4)}(x)$ oraz upraszczamy jej postaÊ. Zgodnie z (\ref{CzynnikM4DoBleduMetodySimpsona}) wyliczamy maksimum  $f^{(4)}(x)$ na przedziale $[a,b]$ (jest to najbardziej znaczπcy krok) i podstawiamy wszystkie znane juø nam argumenty do (\ref{BladMetodySimpsona}). W ten sposÛb dochodzimy do poøπdanej przez nas formy $\delta_S$. 

Posiadajπc juø odpowiednie narzÍdzia (\textbf{Procedura \ref{MAPLE_MetodaSimpsonaCalkaPojedyncza} i \ref{MAPLE_BladMetodySimpsonaCalkaPojedyncza}}) oraz wiedzÍ z zakresu metodyki ich dzia≥ania, wykonajmy pomiary, ktÛre zobrazujπ nam w sposÛb praktyczny dok≥adnoúÊ \textit{metody Simpsona}. Niech $N$ stanowi liczbÍ podzia≥Ûw przedzia≥y ca≥kowania, $W_{simpson}$ opisuje wartoúci zwracane przez \mbox{\textbf{ProcedurÍ \ref{MAPLE_MetodaSimpsonaCalkaPojedyncza}}}. Ponadto  przez $|BBS_{N}|$ oznaczymy b≥πd bezwzglÍdnym przybliøenia wartoúci ca≥ki \textit{metodπ Simpsona}, natomiast przez symbol $\delta_S$ rozumieÊ bÍdziemy wynik wywo≥ania \textbf{Procedury \ref{MAPLE_BladMetodySimpsonaCalkaPojedyncza}}. Do obliczeÒ ponownie wykorzystajmy ca≥kÍ z \textbf{Przyk≥adu \ref{PrzykladCalkaLiczonaWzoremSimpsona}} (zastosujemy rÛwnieø jej wartoúÊ dok≥adnπ, ktÛra jest podana w jego rozwiπzaniu):

\begin{table}[h!]
\caption{Pomiar dok≥adnoúci przybliøenia wartoúci ca≥ki pojedynczej procedurπ \textit{simpson}}
\hspace{-5.5cm}{\footnotesize èrÛd≥o: Opracowanie w≥asne\\}
\centering
 \begin{tabular}{|c|c|c|c|c|} 
 \hline
 $\mathbf{N}$ & $\mathbf{W_{simpson}}$ & $\mathbf{|BBS_N|}$ &$\mathbf{\delta_S}$ \\ [0.5ex] 
 \hline \hline
 4   & 4.09788104673 & 0.03476698811 & 0.31426966780\\ 
 \hline
 6   & 4.07112329317 & 0.00800923455 & 0.06207795906\\
\hline 
 10  & 4.06425014407 & 0.00113608545 & 0.00804530349\\ 
\hline 
 20  & 4.06318804961 & 0.00007399099 & 0.00050283147\\ 
 \hline
 40  & 4.06311873247 & 0.00000467386 & 0.00003142697\\ 
 \hline 
 60  & 4.06311498371 & 0.00000092509 & 0.00000620779\\ 
\hline 
 80  & 4.06311435154 & 0.00000029292 & 0.00000196419\\ 
 \hline
 100 & 4.06311417861 & 0.00000011999 & 0.00000080453\\
\hline 
 104 & 4.06311416121 & 0.00000010259 & 0.00000068771\\  
 \hline 
 106 & 4.06311415370 & 0.00000009508 & 0.00000063726\\ 
\hline 
 150 & 4.06311408231 & 0.00000002369 & 0.00000015892\\ 
 \hline
 200 & 4.06311406613 & 0.00000000751 & 0.00000005028\\
 \hline 
 400 & 4.06311405910 & 0.00000000048 & 0.00000000314\\[0.5ex] 
\hline 
 1000& 4.06311405847 & 0.00000000015 & 0.00000000008\\ 
 \hline
 \end{tabular}\\\hfill
 \label{WynikiZProcedurySimpson}
\end{table}

Analizujπc wyniki z  powyøszej tabeli moøna zauwaøyÊ, øe \textit{metoda parabol} jest optymalniejsza od metody \textit{trapezÛw}, dla ktÛrej to podobne zestawienie sporzπdzono w \mbox{Tablicy \ref{WynikiZProceduryTrapez1}}. B≥πd bezwzglÍdny przybliøenia spad≥ poniøej $0.0000001$ juø dla przypadku, w ktÛrym dokonaliúmy $N=106$ podzia≥Ûw przedzia≥u ca≥kowania, dla porÛwnania w metodzie trapezÛw podzia≥Ûw tych musieliúmy wykonaÊ aø $n=7310$. Wynik zwracany przez procedurÍ \textit{simpson} zaczyna byÊ bardzo mocno zbliøony do dok≥adnego ($4.06311405862$) dla zaledwie $N \geq 20$ podzia≥Ûw (rÛønica zauwaøalna jest dopiero na $5$ miejscu po przecinku). Ponadto mamy podstawy do tego, by uznaÊ algorytm za poprawny, poniewaø wartoúÊ zwracana przez procedurÍ \textit{simpson} dna $N=6$ jest taka sama, jak ta otrzymana w przykladzie \ref{PrzykladCalkaLiczonaWzoremSimpsona}. Co wiÍcej dla kaødego z prezentowanych w tabeli przypadkÛw spe≥niona jest nierÛwnoúÊ (\ref{NierownoscBBPrzyblizenia<=DeltaS}) z \textbf{Definicji \ref{Def_BladPrzyblizeniaWzoremSimpsona}}.

W poprzednim podrozdziale wspominaliúmy, øe niejednokrotnie interesuje nas minimalizacja b≥Ídu dla otrzymanego wyniku, tak by jego wielkoúÊ nie przekracza≥a pewnej akceptowalnej wartoúci granicznej. Wykonujπc drobne zmiany w \textbf{Procedurze \ref{MAPLE_BladMetodySimpsonaCalkaPojedyncza}} jesteúmy w stanie otrzymaÊ nowπ procedurÍ, wyznaczajπcπ iloúÊ podzia≥Ûw $N$ przedzia≥u ca≥kowania $[a,b]$, tak by b≥πd przybliøenia nie przekracza≥ okreúlonej przez nas wartoúci:      

\begin{proc}{(Wyznaczanie najmniejszej liczby $N$ podzia≥Ûw przedzia≥u ca≥kowania tak, by wynik by≥ obciπøony b≥Ídem nie wiÍkszym niø zadany)}
\label{MAPLE_najmniejszyNDlaMetodySimpsonaCalkaPojedyncza}
\begin{verbatim}
> simpsonMinN:= proc (a, b, blad) 
   local d4ff, simd4ff, M4, Nmin, p;
   d4ff:= diff(diff(diff(diff(f(x),x),x),x),x);
   simd4ff:= simplify(d4ff); 
   M4:= (Optimization[Maximize])(abs(simd4ff), x = a .. b);
   p:= solve*({1/180*(b-a)^5*M4[1]/N^4 < blad, N>0}, {N}); 
   Nmin := p[1] 
  end;
\end{verbatim}
\end{proc}   
Zmiana polega na tym, øe ostatnim parametrem wejúciowym jest teraz nie iloúÊ podzia≥Ûw przedzia≥u, lecz akceptowalna maksymalna wielkoúÊ b≥Ídu. RÛwnieø zamiast obliczaÊ $\delta_S$, przekszta≥camy rÛwnanie (\ref{BladMetodySimpsona}) do postaci nastÍpujπcej nierÛwnoúci: $$\frac{(b-a)^5}{180 \cdot N^4} \cdot M_4 < blad .$$ W linii trzeciej od koÒca jest ona  rozwiπzywana ze wzglÍdu na zmiennπ $N$, przy za≥oøeniu, øe interesujπ nas tylko takie wartoúci, gdzie $N>0$. Finalnie procedura wypisuje wynik w postaci $N > z$, przy czym $z\in\mathbb{Z_{+}}$. Nam jednak najbardziej zaleøy na  najbliøszej, wiÍkszej od $z$ liczbie naturalnej, podzielnej przez $2$. W≥aúnie ta liczba jest szukanym przez nas $N$, dla ktÛrego b≥πd przybliøenia bÍdzie mniejszy niø ten podany jako trzeci parametr wywolania \textit{simpsonMinN}.

%\section{WzÛr prostokπtÛw}




