
\chapter{Kwadratury Newtona-Cotesa dla ca³ki pojedynczej}


Niech $f(x)$ bêdzie funkcj¹ zdefiniowan¹ na przedziale $[a,b]$ o wartoœciach rzeczywistych tzn. $f: [a,b]\rightarrow \re$. 
Rozwa¿my pewn¹ ca³kê 
\begin{equation}\label{I(f)=Calkaf(x)}
I(f)=\int\limits_a^b f(x) dx
\end{equation}

Funkcjê podca³kow¹ zawsze mo¿emy zast¹piæ inn¹ funkcj¹ tak¹, ¿e w miarê mo¿liwoœci poni¿sze przybli¿enie bêdzie prawdziwe:
\begin{equation}\label{ZastapienieFunkcjiFxfunkcjaGx}
\int\limits_a^b f(x) dx \approx \int\limits_a^b g(x) dx
\end{equation}

W praktyce czêsto spotkaæ mo¿emy siê z przypadkiem takim, ze do wyznaczenia przybli¿onych wartoœci $I(f)$  stosowane s¹ wzory nazywane kwadraturami. 
Owe kwadratury opieraj¹ siê jedynie na wartoœciach $f(x)$ w punktach wêz³owych i mog¹ niezbyt dok³adnie przybli¿aæ wynik tzn: 
\begin{equation}\label{WzorKwadratura}
\int\limits_a^b f(x) dx \approx \sum\limits_{i=0}^n a_if(x_i),\,\,\,\, x_i\in[a,b],
\end{equation}
przy czym wspó³czynniki $a_i$ s¹ niezale¿ne od $f(x)$ (nazywamy je wspó³czynnikami kwadratury), zaœ $x_i$ nosi miano wêz³ów kwadratury.

Naszym celem jest jednak to, by jak najbardziej zminimalizowaæ b³¹d pojawiaj¹cy siê podczas przybli¿ania wartoœci $I(f)$. W zwi¹zku z tym mo¿emy zastosowaæ zabieg zast¹pienia funkcji $f(x)$ w ca³ce $I(f)$ wielomianem interpoluj¹cym j¹. W tym celu wykorzystamy wielomian interpolacyjny \textit{Lagrange'a} (\ref{wielomianInterpolacyjnyLagrangea}). Po podstawieniu go do (\ref{WzorKwadratura}) otrzymamy:

\begin{equation}\label{SumaCalkowaLagrangeWkwadraturze}
\int\limits_a^b f(x) dx \approx \int\limits_a^b L_n(x) dx=
\sum\limits_{i=0}^n \alpha_i f(x_i) dx,
\end{equation}
gdzie 
\begin{equation}\label{wspolczynnikAi}
\alpha_i=\int\limits_a^b l_i(x),
\end{equation}
 natomiast 
 \begin{equation}\label{l_iDlaKwadraturN-C}
 l_i(x)=\prod\limits_{j=0, j\neq i}^n  \frac{x-x_j}{x_i-x_j} \,\,\,\,\,\,\, (i=0,1,\ldots,n).
 \end{equation}
W zwi¹zku z powy¿szym ca³kê (\ref{I(f)=Calkaf(x)}) mo¿emy wyraziæ w nastêpuj¹cy sposób:
\begin{equation}\label{PrzyblizenieCalkiSumaCalkowaZwielomianamiBazowymiLagrangea}
\int\limits_a^b f(x) dx \approx \sum\limits_{i=0}^n f(x_i)\int\limits_a^b l_i(x) dx
\end{equation}
Je¿eli w (\ref{PrzyblizenieCalkiSumaCalkowaZwielomianamiBazowymiLagrangea}) rozpatrzymy tylko wêz³y takie, ¿e $x_0=a$, $x_n=b$, a ka¿dy wêze³ poœredni le¿¹cy pomiêdzy $x_0$ a $x_n$ jest postaci $x_i=a+ih$ $(i=0,1,\ldots,n)$, $h=\frac{x_n-x_0}{n}$, to kwadraturê tak¹ nazwiemy kwadratur¹ \textbf{Newtona-Cotesa}. Skupimy siê na rozwa¿eniu trzech ró¿nych kwadratur tego typu, bêd¹ nimi: \textit{wzór trapezów}, \textit{wzór Simpsona} oraz \textit{wzór prostok¹tów}.


\section{Wzór trapezów}

%Zauwa¿my, ¿e przybli¿enie $\sum\limits_{i=0}^n f(x_i)\int\limits_a^b L_i(x) dx$ jest szczególnym przypadkiem sumy z równania (\ref{WzorKwadratura}), przy czym: 

%\begin{equation}\label{wspolczynnikAi}
%a_i=\int\limits_a^b L_i(x) dx
%\end{equation}


Do wyznaczenia wzoru trapezów bêdziemy wykorzystywaæ wielomian interpolacyjny \textit{Lagrange'a} rzêdu $n=1$ ($L_1(x)$) utworzony dla wêz³ów $a$ i $b$.
Zastosujmy w (\ref{l_iDlaKwadraturN-C}) nastêpuj¹ce podstawienie: $x=a+hs$. Wartoœci $a,h$ s¹ pewnymi sta³ymi, natomiast $s$ jest zmienn¹ niezale¿n¹.
$$l_i(x)=\prod\limits_{j=0, j\neq i}^n \frac{x-x_j}{x_i-x_j}=
\prod\limits_{j=0, j\neq i}^n \frac{a+hs-(a+jh)}{(a+ih)-(a+jh)}=
\prod\limits_{j=0, j\neq i}^n \frac{s-j}{i-j}$$
Otrzymujemy zatem:
\begin{equation}\label{WielomianLagrangeaPoPodstawieniuZaX}
l_i(x)=\prod\limits_{j=0, j\neq i}^n \frac{s-j}{i-j}=\psi_i(s)
\end{equation}
$\psi_i(s)$ to nasza nowa funkcja zmiennej $s$.


Ca³kê z równania (\ref{wspolczynnikAi}) obliczymy metod¹ ca³kowania przez podstawienie. Skorzystamy z przedstawionego przed chwil¹ podstawienia $x=a+hs$ oraz równania (\ref{WielomianLagrangeaPoPodstawieniuZaX})\\

$a_i=\int\limits_a^b l_i(x) dx=\left\{\begin{array}{ll}
x=a+hs\\
dx=h ds\\
b=a+hs \Rightarrow \frac{b-a}{h}=s\Rightarrow s=n\\
a=a+hs \Rightarrow 0=hs \Rightarrow s=0
\end{array}\right\}=h\int\limits_0^n \psi_i(s)ds
$\\

Chcemy wyliczyæ teraz wartoœci wspó³czynników kwadratury $a_0$ i $a_1$. Pamiêtamy o tym, ¿e  do obliczeñ wykorzystujemy postaæ wielomianu \textit{Lagrange'a} rzêdu $n=1$, zatem bêdziemy ca³kowali w granicach $[0,n]=[0,1]$
$$a_0=h\int\limits_0^1 \phi_0(s) ds=h\int\limits_0^1\frac{s-1}{0-1}ds=\int\limits_0^1(1-s)ds= h\left[s-\frac{s^2}{2}\right]_0^1=\frac{h}{2}$$
$$a_1=h\int\limits_0^1 \phi_1(s) ds=h\int\limits_0^1\frac{s-0}{1-0}ds=\int\limits_0^1(s)ds= h\left[\frac{s^2}{2}\right]_0^1=\frac{h}{2}$$
Po wstawieniu wyliczonych wspó³czynników do (\ref{WzorKwadratura}) otrzymujemy 
\begin{equation}\label{wzorTrapezowBrakPodzialu}
\begin{array}{cc}
\int\limits_a^b f(x) dx \approx \sum\limits_{i=0}^1 a_if(x_i)=a_0f(x_0)+a_1f(x_1)=\\
=\frac{h}{2}f(x_0)+\frac{h}{2}f(x_1)=\frac{h}{2}(f(x_0)+f(x_1))
\end{array}
\end{equation}
Wzór ten nazywamy \textbf{wzorem trapezów}. Zauwa¿my, ¿e suma wspó³czynników $\alpha_0$,$\alpha_1$ jest równa $h\cdot n$. W póŸniejszych podrozdzia³ach równie¿ zetkniemy siê z tak¹ prawid³owoœci¹ rozpatruj¹c wy¿szy rz¹d wielomianów \textit{Lagrange'a} dla $n>1$.
%Gdybyœmy wyliczali wspó³czynniki dla $n=2$, to otrzymalibyœmy wzór \textit{Simpsona}

Podczas wyznaczania (\ref{wzorTrapezowBrakPodzialu}) przyjêliœmy, ¿e przedzia³ ca³kowania nie zosta³ podzielony, a jedynymi wêz³ami by³y jego pocz¹tek i koniec. W rzeczywistoœci rozpatrujemy przypadki z wielokrotnym podzia³em przedzia³u. %Dzieje siê tak, poniewa¿ im wiêcej podzia³ów dokonamy tym dok³adniejszy bêdzie uzyskany wynik. 
Je¿eli przedzia³ ca³kowania $[a,b]$ podzielimy na $\geq 2$ równe czêœci takie, ¿e $a=x_0<x_1<\ldots<x_n=b$, to wzór przyjmie postaæ:
\begin{equation}\label{OgolnyWzorTrapezow}
\begin{array}{cc}
\int\limits_a^b f(x)dx=\sum\limits_{i=0}^{n-1}\int\limits_{x_i}^{x_{i+1}}f(x)dx\approx\\ \approx(\frac{h}{2}(f(x_0)+f(x_1))+\cdots+\frac{h}{2}(f(x_{n-1})+f(x_n)))=\\
=\frac{h}{2}(f(x_0)+2f(x_1)+\cdots+2f(x_{n-1})+f(x_n))=\\ 
=\frac{h}{2}\sum\limits_{i=0}^{n-1}[f(x_i)+f(x_{i+1})]
\end{array}
\end{equation}


W wyprowadzonym powy¿ej wzorze trapezów (jak sama nazwa sugeruje) przybli¿amy wartoœæ ca³ki sumuj¹c pola trapezów o ustalonej wysokoœci $h$ (odleg³oœæ pomiêdzy kolejnymi wêz³ami) i podstawach o d³ugoœci $f(x_i)$ i $f(x_{i+1})$ dla $i=0,1,\ldots,n-1$. Rysunek \ref{R1} z pewnoœci¹ pomo¿e nam lepiej zrozumieæ zagadnienie, na którym siê skupiamy.
\begin{figure}[H]
		\begin{center}
		\includegraphics[scale=0.13]{R2.eps} 
		\end{center}
	   \caption{Graficzne przedstawienie idei zastosowania wzoru trapezów do ca³kowania}
\label{R1}
\end{figure}

PrzejdŸmy do praktycznego zastosowania wzoru (\ref{OgolnyWzorTrapezow}) w celu pokazania jego przydatnoœci. Obliczenia dla zadanej funkcji przeprowadzimy rêcznie przy relatywnie ma³ej liczbie podzia³u przedzia³ów, oraz wykorzystuj¹c procedurê stworzon¹ w jêzyku \textit{Maple} dla du¿o wiêkszej liczby podzia³u. 


\begin{ex}{(Wyznaczanie przybli¿onej wartoœci ca³ki przy wykorzystaniu wzoru trapezów)}\label{PrzykladCalkaPojedynczaMetodaTrapezow}\hfill
\textit{Wyznaczyæ przybli¿on¹ wartoœæ ca³ki $\int\limits_0^{\frac{3}{2}} e^{x^2} dx$ przyjmuj¹c, ¿e przedzia³ ca³kowania dzielimy na n=6 równych czêœci(7 wêz³ów)}\\

Do rozwi¹zania zadania skorzystamy z ogólnego wzoru trapezów. Wyznaczamy wartoœci wêz³ów oraz odleg³oœ $h=\frac{b-a}{n}$ pomiêdzy kolejnymi wêz³ami:\\
$h=\frac{\frac{3}{2}-0}{6}=\frac{1}{4}$, $x_0=0$, $x_1=\frac{1}{4}$, $x_2=\frac{2}{4}$, $x_3=\frac{3}{4}$, $x_4=1$, $x_5=\frac{5}{4}$, $x_6=\frac{6}{4}$.\\ 
Wyliczone wartoœci wstawiamy do (\ref{OgolnyWzorTrapezow}):
\begin{center}
$\int\limits_0^{\frac{3}{2}} e^{x^2} dx=\frac{\frac{1}{4}}{2}(f(x_0)+2f(x_1)+2f(x_2)+2f(x_3)+2f(x_4)+2f(x_5)+f(x_6))=$\\
$=\frac{1}{8}(e^0+2e^{{(\frac{1}{4})}^2}+2e^{{(\frac{2}{4})}^2}+2e^{{(\frac{3}{4})}^2}+2e^1+2e^{{(\frac{5}{4})}^2}+e^{{(\frac{6}{4})}^2})\approx 
\frac{1}{8}(1+2\cdot 1,06449+2\cdot 1,28402+2\cdot 1,75505+2\cdot  2,71828+2\cdot 4,77073+9,48773)\approx 4,20911$\\
\end{center}
Wartoœæ dok³adna wynosi w zaokr¹gleniu $4,063114$. Jak widaæ ró¿nica w wyniku jest dosyæ znacz¹ca przy ustalonych wartoœciach wêz³ów, poniewa¿ otrzymany przez nas wynik to $4,20911$.
\end{ex}


Z regu³y im wiêcej podzia³ów przedzia³u wykonamy, tym dok³adniejsze powinniœmy otrzymamy przybli¿enie. Mo¿na wnioskowaæ w ten sposób równie¿ poddaj¹c siê na analizie wzoru na b³¹d metody trapezów (im wiêkszy $n$ tym mniejsza wartoœæ $\delta_T$):
\begin{definition}{(B³¹d przybli¿enia wzorem trapezów)}\\\hfill
Niech $f: [a,b]\rightarrow \re$ bêdzie klasy $C^2$ na $[a,b]$, oraz niech $n$ wyznacza iloœæ podzia³ów tego przedzia³u, to b³¹d metody trapezów wyra¿a nastêpuj¹cy wzór: 
\begin{equation}\label{BladMetodyTrapezow}
\delta_T = \frac{(b-a)^3}{12n^2} \cdot M_2,
\end{equation}
gdzie 
\begin{equation}\label{CzynnikM2DoBleduMetodyTrapezow}
M_2= \sup_{x \in [a,b]} \, | f^{''}(x) |
\end{equation}

\end{definition}
Sprawdzimy jednak s³usznoœæ naszego twierdzenia wykorzystuj¹c do tego stworzon¹ na nasze potrzeby procedurê w jêzyku Maple. Pos³u¿y nam ona do zautomatyzowania procesu obliczania przybli¿onych wartoœci ca³ek oznaczonych metod¹ trapezów:

\begin{proc}{(Procedura wyznaczaj¹ca wartoœci ca³ek pojedynczych metod¹ trapezów)}\label{MAPLE_MetodaTrapezowCalkaPojedyncza}
\begin{verbatim}
> trapez:=proc(a,b,N) 
local h,j,k,x,y,t,tp; 
h:=(b-a)/N; 
for j from 0 to N do x:= j -> a+j*h od;  
for j from 0 to N do y:= j -> f(x(j)) od;  
t:= h/2 * sum(y(k)+y(k+1), k=0..N-1); 
tp:=evalf(t,12); 
end;
\end{verbatim}
\end{proc}

\hspace{-1cm}{Przed przejœciem do prezentacji wyników jakie zwróci powy¿sza procedura, nale¿y wyjaœniæ nieco jej zasadê dzia³ania i znaczenie parametrów.}

\hspace{-1cm}{Pierwsza linia jest deklaracj¹ procedury \textit{trapez} z nastêpuj¹cymi parametrami wejœciowymi:}\\
\textbf{a}, \textbf{b} - s¹ odpowiednio dolnym i górnym krañcem przedzia³u ca³kowania\\
\textbf{N} - okreœla liczbê podprzedzia³ów na które podzielony zostanie nasz przedzia³ $[a,b]$\\
Kolejno deklarujemy zmienne pomocnicze z których korzysta procedura ( nie pobierane od u¿ytkownika) oraz wyznaczamy wartoœæ kroku $h$, czyli odleg³oœæ pomiêdzy dwoma kolejnymi wêz³ami. Nastêpnie wyznaczamy wszystkie wêz³y na danym przedziale oraz wyliczamy wartoœci (deklarowanej przed wywo³ywaniem procedury) funkcji $f$ w tych¿e wêz³ach. Przedostatni krok polega na zsumowaniu wyliczonych przed chwil¹ wartoœci w sposób zgodny ze wzorem (\ref{OgolnyWzorTrapezow}). Algorytm koñczymy poprzez przekszta³cenie sumy do "przyjaznej" \,postaci i prezentacjê wyniku z dok³adnoœci¹ do 12 miejsc po przecinku. 


Poni¿sza tabela prezentuje wyniki procedury  \ref{MAPLE_MetodaTrapezowCalkaPojedyncza} (ozn. $W_{trapez}$) dla coraz to wiêkszej liczby podprzedzia³ów $N$. Uwzglêdniono w niej równie¿ wartoœci b³êdów wzoru trapezów (ozn. $\delta_T$) wyliczone zgodnie ze wzorem (\ref{BladMetodyTrapezow}) oraz modu³  ró¿nicy pomiêdzy wartoœci¹ dok³adn¹ ca³ki a otrzyman¹ w ramach testów procedury (ozn. $|W-W_{trapez}|$). Do kalkulacji wykorzystamy funkcjê z przyk³adu \ref{PrzykladCalkaPojedynczaMetodaTrapezow} oraz podan¹ w rozwi¹zaniu informacjê na temat przybli¿onej do 6 miejsca po przecinku wartoœci dok³adnej ca³ki $\int\limits_0^{\frac{3}{2}} e^{x^2} dx\approx 4,063114$.  \\

\begin{table}[h!]
\label{WynikiZProceduryTrapez}
\centering
 \begin{tabular}{|c|c|c|c|} 
 \hline
 $\mathbf{N}$ & $\mathbf{W_{trapez}}$ &$\mathbf{\delta_T}$& $\mathbf{|W-W_{trapez}|}$  \\ [0.5ex] 
 \hline \hline
 6 &  &  &  \\ 
 \hline
 30&  &  & \\
 \hline 
 100&  &  &  \\
 \hline 
 200&  &  &  \\
 \hline 
 400&  &  & \\ 
  \hline 
 800&  &  & \\
  \hline 
 1200&  &  & \\
  \hline 
 2000&  &  & \\
  \hline 
 5000&  &  & \\[0.5ex] 
 \hline 
 \end{tabular}
\end{table}

-------------DODAC:  porównaæ wyniki otrzymane metod¹ trapezów dla n=6 liczone recznie i dla duzego n liczonego procedur¹, pokazaæ ze im wiêksza liczba podzia³ów tym dok³adniejszy wynik, pokazaæ ze mozna wyliczyæ minimaln¹ liczbê podzia³u przedzia³ów by otrzymaæ wynik z maksymalnie okreslonym bledem-------- 




\section{Wzór Simpsona}
\section{Wzór prostok¹tów}

